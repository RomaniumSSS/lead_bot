# –ü–ª–∞–Ω 001: –£–ª—É—á—à–µ–Ω–∏–µ LLM-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ User Flow

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 23.12.2025
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 23.12.2025
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

---

## Objective (–¶–µ–ª—å)

–£–ª—É—á—à–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å LLM (Claude API) –≤ —Ç—Ä—ë—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö:
1. –†–∞—Å—à–∏—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Claude –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –∫–Ω–æ–ø–∫–µ "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å"
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π user flow –≤ Telegram
3. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è LLM –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX

---

## Context (–ö–æ–Ω—Ç–µ–∫—Å—Ç)

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- ‚úÖ FSM-–¥–∏–∞–ª–æ–≥ —Å –∫–Ω–æ–ø–∫–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∑–∞–¥–∞—á–∞ ‚Üí –±—é–¥–∂–µ—Ç ‚Üí —Å—Ä–æ–∫ ‚Üí –¥–µ–π—Å—Ç–≤–∏–µ)
- ‚úÖ LLM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `generate_response_free_chat()` –¥–ª—è —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
- ‚úÖ LLM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `parse_custom_meeting_time()` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤—Ä–µ–º–µ–Ω–∏
- ‚ö†Ô∏è –ö–Ω–æ–ø–∫–∞ "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å" –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ FREE_CHAT –±–µ–∑ —É–º–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫
- ‚ö†Ô∏è –ù–µ—Ç —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ flow
- ‚ö†Ô∏è LLM –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, —Ä–µ–∑—é–º–µ, follow-up)

### –ü—Ä–æ–±–ª–µ–º—ã:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ—Å–ª–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–µ –≤—Å–µ–≥–¥–∞ –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç—å —É –±–æ—Ç–∞
2. –ù–µ—Ç –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ user flow (—Ç–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç—ã)
3. –í–ª–∞–¥–µ–ª–µ—Ü –ø–æ–ª—É—á–∞–µ—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ, –±–µ–∑ —É–º–Ω–æ–≥–æ —Ä–µ–∑—é–º–µ –æ—Ç LLM

---

## Proposed Steps (–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ —à–∞–≥–∏)

### üìã –§–∞–∑–∞ 1: –£–ª—É—á—à–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å"

#### 1.1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
**–§–∞–π–ª—ã**: `src/services/llm.py`, `src/keyboards/__init__.py`, `src/handlers/conversation.py`

**–ó–∞–¥–∞—á–∞**: –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å", –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Claude 3-4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ª–∏–¥–∞.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `generate_suggested_questions(lead: Lead) -> list[str]` –≤ `llm.py`
- –ü—Ä–æ–º–ø—Ç –¥–ª—è Claude: "–ù–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç—É—Å–∞ –ª–∏–¥–∞ ({—Å—Ç–∞—Ç—É—Å}), –∑–∞–¥–∞—á–∏ ({–∑–∞–¥–∞—á–∞}), –±—é–¥–∂–µ—Ç–∞ ({–±—é–¥–∂–µ—Ç}) –ø—Ä–µ–¥–ª–æ–∂–∏ 3-4 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –∑–∞–¥–∞—Ç—å"
- –î–æ–±–∞–≤–∏—Ç—å inline –∫–Ω–æ–ø–∫–∏ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ + –∫–Ω–æ–ø–∫–∞ "–°–≤–æ–π –≤–æ–ø—Ä–æ—Å"
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—ã–±–æ—Ä –≤–æ–ø—Ä–æ—Å–∞ –≤ `conversation.py`

**–ü—Ä–∏–º–µ—Ä**:
```
–ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?
[üìã –°–∫–æ–ª—å–∫–æ –∑–∞–π–º—ë—Ç —Ä–∞–±–æ—Ç–∞?]
[üí∞ –ú–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –æ–ø–ª–∞—Ç—É –Ω–∞ —ç—Ç–∞–ø—ã?]
[üé® –ü–æ–∫–∞–∂–µ—Ç–µ –ø—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç?]
[‚úçÔ∏è –°–≤–æ–π –≤–æ–ø—Ä–æ—Å]
```

#### 1.2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
**–§–∞–π–ª—ã**: `src/services/llm.py`

**–ó–∞–¥–∞—á–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å prompt caching –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –±–∏–∑–Ω–µ—Å–∞
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –ª–∏–¥–∞ –∫–∞–∫ user message
- –¢–æ–∫–µ–Ω—ã: cache_read —ç–∫–æ–Ω–æ–º–∏—Ç –¥–æ 90% –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

---

### üß™ –§–∞–∑–∞ 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ User Flow

#### 2.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
**–§–∞–π–ª—ã**: –Ω–æ–≤—ã–π —Ñ–∞–π–ª `tests/test_integration.py` –∏–ª–∏ `tests/manual_test_scenarios.md`

**–ó–∞–¥–∞—á–∞**: –°–æ–∑–¥–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –º–∞–Ω—É–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Telegram

**–°—Ü–µ–Ω–∞—Ä–∏–∏**:
1. **–ì–æ—Ä—è—á–∏–π –ª–∏–¥**: –°–∞–π—Ç ‚Üí 150–∫+ ‚ÇΩ ‚Üí –°—Ä–æ—á–Ω–æ ‚Üí –ù–∞–∑–Ω–∞—á–∏—Ç—å –≤—Å—Ç—Ä–µ—á—É
2. **–¢—ë–ø–ª—ã–π –ª–∏–¥**: –î–∏–∑–∞–π–Ω ‚Üí 50-150–∫ ‚ÇΩ ‚Üí –°–∫–æ—Ä–æ ‚Üí –ü–æ–ª—É—á–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã
3. **–•–æ–ª–æ–¥–Ω—ã–π –ª–∏–¥**: –°–≤–æ—è –∑–∞–¥–∞—á–∞ (–Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è) ‚Üí –ù–µ –∑–Ω–∞—é ‚Üí –ù–µ —Å—Ä–æ—á–Ω–æ
4. **–°–≤–æ–±–æ–¥–Ω—ã–π –¥–∏–∞–ª–æ–≥**: –ü–æ—Å–ª–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∑–∞–¥–∞—Ç—å 3-5 –≤–æ–ø—Ä–æ—Å–æ–≤
5. **–ü–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏**: "–∑–∞–≤—Ç—Ä–∞ –≤ 15:00", "–≤ —Å—Ä–µ–¥—É –≤ 10:00"
6. **–ö–æ–º–∞–Ω–¥—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞**: `/stats` –æ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏ –æ—Ç –Ω–µ-–≤–ª–∞–¥–µ–ª—å—Ü–∞

#### 2.2. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ aiogram testing utils (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
**–§–∞–π–ª—ã**: `tests/test_handlers_e2e.py`

**–ó–∞–¥–∞—á–∞**: –°–æ–∑–¥–∞—Ç—å E2E —Ç–µ—Å—Ç—ã —Å –º–æ–∫–æ–º Telegram API

**–ü–æ–¥—Ö–æ–¥**:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `aiogram.test_utils` –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–Ω—ã–π flow: /start ‚Üí –≤—ã–±–æ—Ä –∑–∞–¥–∞—á–∏ ‚Üí –±—é–¥–∂–µ—Ç ‚Üí —Å—Ä–æ–∫ ‚Üí –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è

---

### ‚ú® –§–∞–∑–∞ 3: –ù–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è LLM

#### 3.1. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
**–§–∞–π–ª—ã**: `src/services/llm.py`, `src/handlers/start.py`

**–ó–∞–¥–∞—á–∞**: –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ –∏ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –§—É–Ω–∫—Ü–∏—è `generate_greeting(lead: Lead) -> str`
- –ü—Ä–æ–º–ø—Ç: "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è {–∏–º—è} –≤ {–≤—Ä–µ–º—è —Å—É—Ç–æ–∫}. –¢–æ–Ω: –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –Ω–æ —Ç—ë–ø–ª—ã–π."
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `/start` handler

**–ü—Ä–∏–º–µ—Ä**:
```
–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –ò–≤–∞–Ω! üëã
–Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∫–æ–º–ø–∞–Ω–∏–∏ WebStudio. –†–∞–¥ –ø–æ–º–æ—á—å!
```

#### 3.2. –£–º–Ω–æ–µ —Ä–µ–∑—é–º–µ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
**–§–∞–π–ª—ã**: `src/services/llm.py`, `src/services/notifier.py`

**–ó–∞–¥–∞—á–∞**: –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –§—É–Ω–∫—Ü–∏—è `generate_lead_summary(lead: Lead) -> str`
- –ü—Ä–æ–º–ø—Ç: "–ù–∞ –æ—Å–Ω–æ–≤–µ –¥–∏–∞–ª–æ–≥–∞ —Å–æ–∑–¥–∞–π –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –±–∏–∑–Ω–µ—Å–∞"
- –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—é–º–µ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ `notify_owner_about_lead()`

**–ü—Ä–∏–º–µ—Ä**:
```
üî• –ù–æ–≤—ã–π –ì–û–†–Ø–ß–ò–ô –ª–∏–¥!

üìù –†–µ–∑—é–º–µ: –ò–≤–∞–Ω –∏—â–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Å–∞–π—Ç–∞
—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π CRM. –ë—é–¥–∂–µ—Ç 150–∫, –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏.
–ì–æ—Ç–æ–≤ –æ–±—Å—É–¥–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Å–µ–≥–æ–¥–Ω—è.

üë§ –ò–º—è: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤
üìÖ –í—Å—Ç—Ä–µ—á–∞: –°–µ–≥–æ–¥–Ω—è 19:00
```

#### 3.3. –ê–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
**–§–∞–π–ª—ã**: `src/services/llm.py`

**–ó–∞–¥–∞—á–∞**: –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ª–∏–¥–∞ —á–µ—Ä–µ–∑ LLM

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –§—É–Ω–∫—Ü–∏—è `analyze_lead_sentiment(lead: Lead) -> dict`
- –ü—Ä–æ–º–ø—Ç: "–û—Ü–µ–Ω–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —à–∫–∞–ª–µ 1-10"
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–π –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–ª–∏ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**:
```json
{
  "sentiment_score": 8,
  "readiness_score": 9,
  "sentiment_label": "–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π, –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–π",
  "notes": "–ö–ª–∏–µ–Ω—Ç –∑–∞–¥–∞–ª –¥–µ—Ç–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –≥–æ—Ç–æ–≤ –∫ –≤—Å—Ç—Ä–µ—á–µ"
}
```

#### 3.4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è follow-up —Å–æ–æ–±—â–µ–Ω–∏–π
**–§–∞–π–ª—ã**: `src/services/llm.py`, `src/services/scheduler.py` (–Ω–∞ –±—É–¥—É—â–µ–µ)

**–ó–∞–¥–∞—á–∞**: –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ follow-up —Å–æ–æ–±—â–µ–Ω–∏—è

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –§—É–Ω–∫—Ü–∏—è `generate_followup_message(lead: Lead, days_since_last: int) -> str`
- –ü—Ä–æ–º–ø—Ç: "–°–æ–∑–¥–∞–π –º—è–≥–∫–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –¥–ª—è –ª–∏–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –æ—Ç–≤–µ—á–∞–ª {days} –¥–Ω–µ–π"
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å `scheduler.py` (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)

**–ü—Ä–∏–º–µ—Ä**:
```
–ü—Ä–∏–≤–µ—Ç, –ú–∞—Ä–∏—è! üëã

–í–∏–∂—É, –≤—ã –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª–∏—Å—å –¥–∏–∑–∞–π–Ω–æ–º —Å–∞–π—Ç–∞ –¥–ª—è –∫–∞—Ñ–µ.
–ï—Å–ª–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ ‚Äî —Å —Ä–∞–¥–æ—Å—Ç—å—é –æ—Ç–≤–µ—á—É –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã!
```

---

## Implementation Order (–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (MVP+): ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
1. ‚úÖ **–§–∞–∑–∞ 1.1** ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (—É–ª—É—á—à–µ–Ω–∏–µ UX) ‚Äî **–ì–û–¢–û–í–û**
2. ‚úÖ **–§–∞–∑–∞ 2.1** ‚Äî –ú–∞–Ω—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏) ‚Äî **–ì–û–¢–û–í–û**
3. ‚úÖ **–§–∞–∑–∞ 3.2** ‚Äî –£–º–Ω–æ–µ —Ä–µ–∑—é–º–µ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–±–∏–∑–Ω–µ—Å-—Ü–µ–Ω–Ω–æ—Å—Ç—å) ‚Äî **–ì–û–¢–û–í–û**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (Post-MVP): ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
4. ‚úÖ **–§–∞–∑–∞ 3.1** ‚Äî –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è ‚Äî **–ì–û–¢–û–í–û**
5. ‚úÖ **–§–∞–∑–∞ 3.4** ‚Äî Follow-up —Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî **–ì–û–¢–û–í–û** (—Ñ—É–Ω–∫—Ü–∏—è –≥–æ—Ç–æ–≤–∞, –∂–¥—ë—Ç scheduler)

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
6. ‚ö™ **–§–∞–∑–∞ 2.2** ‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
7. ‚ö™ **–§–∞–∑–∞ 3.3** ‚Äî –ê–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è)

---

## Risks (–†–∏—Å–∫–∏)

### 1. –°—Ç–æ–∏–º–æ—Å—Ç—å Claude API
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π LLM-—Å—Ü–µ–Ω–∞—Ä–∏–π = –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã = —Å—Ç–æ–∏–º–æ—Å—Ç—å

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å prompt caching (—ç–∫–æ–Ω–æ–º–∏—è –¥–æ 90%)
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å `max_tokens` –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Claude Haiku –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, follow-up)

### 2. –ó–∞–¥–µ—Ä–∂–∫–∏ –æ—Ç–≤–µ—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ LLM –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-3 —Å–µ–∫—É–Ω–¥—ã

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å "–ì–µ–Ω–µ—Ä–∏—Ä—É—é –≤–æ–ø—Ä–æ—Å—ã..." –∏–ª–∏ typing indicator
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback: –µ—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### 3. –ö–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞**: Claude –º–æ–∂–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –¢—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö
- –î–æ–±–∞–≤–∏—Ç—å fallback-–ª–æ–≥–∏–∫—É —Å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—Ç–≤–µ—Ç—ã LLM –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ Telegram –∞–∫–∫–∞—É–Ω—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞**: –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ Telegram

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π Telegram –∞–∫–∫–∞—É–Ω—Ç
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å aiogram testing utils –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –º–∞–Ω—É–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## Rollback Strategy (–°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Ç–∫–∞—Ç–∞)

### –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

1. **–§–∞–∑–∞ 1 (–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤):**
   - –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ –ø—Ä–æ—Å—Ç–æ–π –∫–Ω–æ–ø–∫–µ "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å" –±–µ–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
   - –£–±—Ä–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥ –∏–∑ `conversation.py` –∏ `llm.py`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ FREE_CHAT —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

2. **–§–∞–∑–∞ 2 (–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ):**
   - –ù–µ—Ç —Ä–∏—Å–∫–∞ ‚Äî —Ç–µ—Å—Ç—ã –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
   - –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã

3. **–§–∞–∑–∞ 3 (–ù–æ–≤—ã–µ LLM-—Å—Ü–µ–Ω–∞—Ä–∏–∏):**
   - –û—Ç–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ feature flag (–µ—Å–ª–∏ –¥–æ–±–∞–≤–∏–º)
   - –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º —Ç–µ–∫—Å—Ç–∞–º –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö
   - –£–¥–∞–ª–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `llm.py`

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ: `make run`
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π flow: /start ‚Üí –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –≤—Å—Ç—Ä–µ—á–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `tail -f logs/bot.log`
- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã: `make test`

---

## Success Criteria (–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞)

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ (Must Have):
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 3-4 –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞
- ‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ user flow —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ)
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü—É —Å–æ–¥–µ—Ä–∂–∞—Ç —É–º–Ω–æ–µ —Ä–µ–∑—é–º–µ –æ—Ç LLM
- ‚úÖ –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ
- ‚úÖ Prompt caching –≤–∫–ª—é—á—ë–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö)

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (Nice to Have):
- üü° –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- üü° –ì–µ–Ω–µ—Ä–∞—Ü–∏—è follow-up —Å–æ–æ–±—â–µ–Ω–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- üü° –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ E2E —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã
- üü° –ê–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é

### –ú–µ—Ç—Ä–∏–∫–∏:
- **Response Time**: –∫–Ω–æ–ø–∫–∞ "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å" ‚Üí –≤–∞—Ä–∏–∞–Ω—Ç—ã < 3 —Å–µ–∫
- **Token Efficiency**: cache hit rate > 50% (—á–µ—Ä–µ–∑ prompt caching)
- **User Engagement**: –∫–ª–∏–∫–∏ –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–º –≤–æ–ø—Ä–æ—Å–∞–º > 60%
- **Owner Satisfaction**: —Ä–µ–∑—é–º–µ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö –ø–æ–ª–µ–∑–Ω–µ–µ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## Technical Notes

### –ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã:
```
src/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ llm.py              # +generate_suggested_questions, +generate_lead_summary
‚îÇ   ‚îî‚îÄ‚îÄ notifier.py          # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ–∑—é–º–µ
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ conversation.py      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ start.py             # (–æ–ø—Ü.) –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py          # +get_suggested_questions_keyboard
tests/
‚îú‚îÄ‚îÄ test_integration.py      # –ù–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è E2E
‚îî‚îÄ‚îÄ manual_test_scenarios.md # –ù–æ–≤—ã–π —Ñ–∞–π–ª —Å –º–∞–Ω—É–∞–ª—å–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- ‚úÖ Anthropic SDK —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚úÖ tenacity (retry) —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚úÖ aiogram testing utils (—É–∂–µ –≤ dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö)

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- –í–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `.env`: `LLM_ENABLE_SUGGESTIONS=true` –¥–ª—è feature toggle

---

## Questions

1. **–ù—É–∂–Ω—ã –ª–∏ fallback-–≤–æ–ø—Ä–æ—Å—ã**, –µ—Å–ª–∏ Claude –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã? (–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –¥–∞)
2. **–ö–∞–∫–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –±—ã—Å—Ç—Ä–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –§–∞–∑—ã 1 –∏–ª–∏ –ø–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö 3 —Ñ–∞–∑? (–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –§–∞–∑–∞ 1 + 2.1 + 3.2)
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ Claude Haiku –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á** (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è)? (–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –¥–∞, –¥–µ—à–µ–≤–ª–µ)
4. **–ù—É–∂–µ–Ω –ª–∏ –∞–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è** –∏–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ rule-based –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏? (–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ø–æ–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)

---

---

## –û—Ç—á—ë—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 23.12.2025

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

#### ‚úÖ –§–∞–∑–∞ 1.1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `generate_suggested_questions()` –≤ `src/services/llm.py`
- –°–æ–∑–¥–∞–Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ `get_suggested_questions_keyboard()` –≤ `src/keyboards/__init__.py`
- –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handle_question_callback()` –≤ `src/handlers/conversation.py`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–Ω–æ–ø–∫—É "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å" —Å –ø–æ–∫–∞–∑–æ–º "–ì–µ–Ω–µ—Ä–∏—Ä—É—é –≤–æ–ø—Ä–æ—Å—ã..."
- Fallback-–≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏ LLM
- Prompt caching –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤

#### ‚úÖ –§–∞–∑–∞ 3.2: –£–º–Ω–æ–µ —Ä–µ–∑—é–º–µ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `generate_lead_summary()` –≤ `src/services/llm.py`
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ `notify_owner_about_lead()` –≤ `src/services/notifier.py`
- –†–µ–∑—é–º–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ + —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- Fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–µ —Ä–µ–∑—é–º–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ LLM
- Prompt caching –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤

#### ‚úÖ –§–∞–∑–∞ 2.1: –ú–∞–Ω—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/manual_test_guide.md` —Å 9 –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ, –∑–∞–ø—É—Å–∫—É –∏ –ø—Ä–æ–≤–µ—Ä–∫–µ
- –ß–µ–∫-–ª–∏—Å—Ç –∏ —à–∞–±–ª–æ–Ω –æ—Ç—á—ë—Ç–∞ –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

```
src/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ llm.py              # +generate_suggested_questions, +generate_lead_summary
‚îÇ   ‚îî‚îÄ‚îÄ notifier.py         # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è LLM-—Ä–µ–∑—é–º–µ
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îî‚îÄ‚îÄ conversation.py     # +handle_question_callback, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py         # +get_suggested_questions_keyboard
tests/
‚îî‚îÄ‚îÄ manual_test_guide.md    # –ù–æ–≤—ã–π —Ñ–∞–π–ª —Å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
```

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:

- ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ Ruff –ø—Ä–æ–π–¥–µ–Ω—ã (0 –æ—à–∏–±–æ–∫)
- ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ MyPy –ø—Ä–æ–π–¥–µ–Ω—ã (0 –æ—à–∏–±–æ–∫)
- ‚úÖ –í—Å–µ unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã (12/12)
- ‚úÖ –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã AICODE-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π

### –ú–µ—Ç—Ä–∏–∫–∏:

- **–ù–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π**: 2 (generate_suggested_questions, generate_lead_summary)
- **–ù–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**: 1 (handle_question_callback)
- **–ù–æ–≤—ã—Ö –∫–ª–∞–≤–∏–∞—Ç—É—Ä**: 1 (get_suggested_questions_keyboard)
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ**: ~350
- **–¢–æ–∫–µ–Ω–æ–≤ —ç–∫–æ–Ω–æ–º–∏–∏**: –¥–æ 90% —á–µ—Ä–µ–∑ prompt caching

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:

–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –º–∞–Ω—É–∞–ª—å–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º –∏–∑ `tests/manual_test_guide.md`.

**–î–ª—è –∑–∞–ø—É—Å–∫–∞**:
```bash
make db-start
make migrate
make run
```

**–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π**:
1. –ü—Ä–æ–π—Ç–∏ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é (–∑–∞–¥–∞—á–∞ ‚Üí –±—é–¥–∂–µ—Ç ‚Üí —Å—Ä–æ–∫)
2. –ù–∞–∂–∞—Ç—å "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å" ‚Üí —É–≤–∏–¥–µ—Ç—å 3-4 —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü—É ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–º–Ω–æ–µ —Ä–µ–∑—é–º–µ –æ—Ç LLM

---

#### ‚úÖ –§–∞–∑–∞ 3.1: –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `generate_greeting()` –≤ `src/services/llm.py`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Claude Haiku –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ –∏ –∏–º–µ–Ω–∏
- –£—á–∏—Ç—ã–≤–∞–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ª–∏ –∫–ª–∏–µ–Ω—Ç
- Fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ `/start` handler

#### ‚úÖ –§–∞–∑–∞ 3.4: Follow-up —Å–æ–æ–±—â–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `generate_followup_message()` –≤ `src/services/llm.py`
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º—è–≥–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ª–∏–¥–æ–≤
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç (–∑–∞–¥–∞—á–∞, –±—é–¥–∂–µ—Ç, —Å—Ç–∞—Ç—É—Å)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Claude Haiku
- Fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- **–ì–æ—Ç–æ–≤–∞ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** —Å scheduler (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2):

```
src/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ llm.py              # +generate_greeting, +generate_followup_message
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îî‚îÄ‚îÄ start.py            # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
```

### –ú–µ—Ç—Ä–∏–∫–∏ (–∏—Ç–æ–≥–æ–≤—ã–µ):

- **–ù–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π**: 4 (questions, summary, greeting, followup)
- **–ù–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**: 1 (handle_question_callback)
- **–ù–æ–≤—ã—Ö –∫–ª–∞–≤–∏–∞—Ç—É—Ä**: 1 (get_suggested_questions_keyboard)
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~600
- **–¢–æ–∫–µ–Ω–æ–≤ —ç–∫–æ–Ω–æ–º–∏–∏**: –¥–æ 90% —á–µ—Ä–µ–∑ prompt caching + Claude Haiku –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á

---

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üöÄ**

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã 1 –∏ 2 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ (E2E —Ç–µ—Å—Ç—ã, –∞–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è) –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ.
