# –ü–ª–∞–Ω 002: –†–µ–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–∏

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 23.12.2025
**–°—Ç–∞—Ç—É—Å**: üîÑ –í —Ä–∞–±–æ—Ç–µ
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ –í—ã—Å–æ–∫–∏–π

---

## Objective (–¶–µ–ª—å)

–î–æ–±–∞–≤–∏—Ç—å **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤**, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –ª–æ–≤—è—Ç –±–∞–≥–∏:
- –¢–µ—Å—Ç—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (–∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è, –ø–∞—Ä—Å–∏–Ω–≥)
- –¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (keyboards)
- –ù–ï –º–æ–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö API (–±–µ—Å–ø–æ–ª–µ–∑–Ω–æ)

**–ü—Ä–∏–Ω—Ü–∏–ø**: –ö–∞—á–µ—Å—Ç–≤–æ > –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ. 20 –ø–æ–ª–µ–∑–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –ª—É—á—à–µ 100 –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã—Ö.

---

## –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –∏ –ü–û–ß–ï–ú–£

### ‚úÖ –¢–µ—Å—Ç 1: `_qualify_lead()` ‚Äî –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏–¥–æ–≤

**–ü–æ—á–µ–º—É –∫—Ä–∏—Ç–∏—á–Ω–æ:**
–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –ø–æ–ª—É—á–∏—Ç –ª–∏ –≤–ª–∞–¥–µ–ª–µ—Ü —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ª–∏–¥–µ.
–û—à–∏–±–∫–∞ –∑–¥–µ—Å—å = –ø–æ—Ç–µ—Ä—è –¥–µ–Ω–µ–≥.

**–†–µ–∞–ª—å–Ω—ã–π –±–∞–≥ –∫–æ—Ç–æ—Ä—ã–π –ø–æ–π–º–∞–µ–º:**
```python
# –ö—Ç–æ-—Ç–æ —Å–ª—É—á–∞–π–Ω–æ –∏–∑–º–µ–Ω–∏—Ç —É—Å–ª–æ–≤–∏–µ:
if deadline_type == "urgent" and budget in ["150 000+ ‚ÇΩ"]:  # –ó–∞–±—ã–ª–∏ —Å—Ä–µ–¥–Ω–∏–π –±—é–¥–∂–µ—Ç
    return LeadStatus.HOT
# –ö–ª–∏–µ–Ω—Ç—ã —Å 50-150–∫ –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç –±—ã—Ç—å HOT
```

**–§–∞–π–ª**: `tests/test_qualification.py`

---

### ‚úÖ –¢–µ—Å—Ç 2: `_parse_llm_response()` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç Claude

**–ü–æ—á–µ–º—É –∫—Ä–∏—Ç–∏—á–Ω–æ:**
Claude –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö. –°–ª–æ–º–∞–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ = –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –º—É—Å–æ—Ä–æ–º.

**–†–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã:**
1. –ß–∏—Å—Ç—ã–π JSON
2. JSON –≤ markdown –±–ª–æ–∫–µ (\`\`\`json ... \`\`\`)
3. –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å –æ—Ç Claude
4. –í–æ–æ–±—â–µ –Ω–µ JSON (Claude –≥–∞–ª–ª—é—Ü–∏–Ω–∏—Ä—É–µ—Ç)

**–§–∞–π–ª**: `tests/test_llm_parsing.py`

---

### ‚úÖ –¢–µ—Å—Ç 3: Keyboards —Å–æ–∑–¥–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

**–ü–æ—á–µ–º—É –∫—Ä–∏—Ç–∏—á–Ω–æ:**
–ï—Å–ª–∏ –∑–∞–±—ã—Ç—å `callback_data` –∏–ª–∏ –æ—à–∏–±–∏—Ç—å—Å—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ ‚Äî –±–æ—Ç —É–ø–∞–¥—ë—Ç –≤ runtime.

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º:**
- –í—Å–µ keyboard —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –≤–∞–ª–∏–¥–Ω—ã–π `InlineKeyboardMarkup`
- –ö–Ω–æ–ø–∫–∏ –∏–º–µ—é—Ç `callback_data`
- HOT –ª–∏–¥ –≤–∏–¥–∏—Ç –∫–Ω–æ–ø–∫—É –≤—Å—Ç—Ä–µ—á–∏, COLD ‚Äî –Ω–µ—Ç

**–§–∞–π–ª**: `tests/test_keyboards.py`

---

## –ß—Ç–æ –ù–ï —Ç–µ—Å—Ç–∏—Ä—É–µ–º –∏ –ü–û–ß–ï–ú–£

| –ß—Ç–æ | –ü–æ—á–µ–º—É –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ |
|-----|-------------------|
| `generate_*()` —Ñ—É–Ω–∫—Ü–∏–∏ | –≠—Ç–æ –æ–±—ë—Ä—Ç–∫–∏ –Ω–∞–¥ Claude API. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–∫ = –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–µ–π–∫ |
| Handlers —Å –º–æ–∫–∞–º–∏ | –ú–æ–∫ Telegram ‚â† —Ä–µ–∞–ª—å–Ω—ã–π Telegram. –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–∑–Ω–µ–µ |
| Scheduler —Å –º–æ–∫–∞–º–∏ | –õ—É—á—à–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∞–º–∏ –≤ production |
| Notifier | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ª–∏–±–æ —É—à–ª–æ, –ª–∏–±–æ –Ω–µ—Ç. –ú–æ–∫ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–∞—Å—Ç |

---

## Implementation

### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:

```
tests/
‚îú‚îÄ‚îÄ conftest.py              # –°—É—â–µ—Å—Ç–≤—É–µ—Ç (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
‚îú‚îÄ‚îÄ test_qualification.py    # –ù–û–í–´–ô ‚Äî —Ç–µ—Å—Ç—ã –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ test_llm_parsing.py      # –ù–û–í–´–ô ‚Äî —Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
‚îî‚îÄ‚îÄ test_keyboards.py        # –ù–û–í–´–ô ‚Äî —Ç–µ—Å—Ç—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ë—ã–ª–æ | –°—Ç–∞–Ω–µ—Ç |
|---------|------|--------|
| –¢–µ—Å—Ç–æ–≤ | 12 | ~30 |
| –ü–æ–∫—Ä—ã—Ç–∏–µ | 7% | ~20-25% |
| –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ | 0/2 | 2/2 |
| –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | 0.2s | < 1s |

---

## Success Criteria

- [x] `_qualify_lead()` –ø–æ–∫—Ä—ã—Ç–∞ –≤—Å–µ–º–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è–º–∏ –±—é–¥–∂–µ—Ç/—Å—Ä–æ–∫
- [x] `_parse_llm_response()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã Claude
- [x] Keyboards —Å–æ–∑–¥–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –∑–∞ < 1 —Å–µ–∫—É–Ω–¥—É
- [x] `make test` –∑–µ–ª—ë–Ω—ã–π

---

## –í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**~45 –º–∏–Ω—É—Ç** –Ω–∞ –≤—Å—ë:
- 15 –º–∏–Ω ‚Äî —Ç–µ—Å—Ç—ã –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏
- 20 –º–∏–Ω ‚Äî —Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞
- 10 –º–∏–Ω ‚Äî —Ç–µ—Å—Ç—ã keyboards
