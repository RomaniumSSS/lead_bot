# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–î–æ–∫—É–º–µ–Ω—Ç —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Å–¥–µ–ª–∞–Ω—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã pre-commit hooks –∏ —Ç–µ—Å—Ç–æ–≤.

---

## üêõ –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã

### 1. MyPy –æ—à–∏–±–∫–∏ –≤ pre-commit

**–ü—Ä–æ–±–ª–µ–º–∞**: Pre-commit hook MyPy –Ω–∞—Ö–æ–¥–∏–ª 13 –æ—à–∏–±–æ–∫ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ:
- Tortoise ORM: –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç `Model` (—Ç–∏–ø `Any`)
- aiogram: untyped –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –≤ handlers
- anthropic: –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è MyPy
- –õ–∏—à–Ω–∏–µ `type: ignore` –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

### 2. –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞**: `AttributeError: 'Connection' object has no attribute 'start'`
- –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π Tortoise ORM –∏ aiosqlite
- –¢–µ—Å—Ç—ã –Ω–µ –º–æ–≥–ª–∏ —Å–æ–∑–¥–∞—Ç—å in-memory SQLite –ë–î

---

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MyPy –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫ –±–µ–∑ —Ç–∏–ø–æ–≤

**–§–∞–π–ª**: `pyproject.toml`

–î–æ–±–∞–≤–ª–µ–Ω—ã per-file overrides –¥–ª—è MyPy:

```toml
# –î–ª—è —Ñ–∞–π–ª–æ–≤ —Å Tortoise ORM –º–æ–¥–µ–ª—è–º–∏
[[tool.mypy.overrides]]
module = "src.database.models"
disallow_subclassing_any = false
warn_unused_ignores = false

# –î–ª—è —Ñ–∞–π–ª–æ–≤ —Å aiogram handlers –∏ middlewares
[[tool.mypy.overrides]]
module = [
    "src.handlers.*",
    "src.middlewares.*",
]
disallow_untyped_decorators = false
disallow_subclassing_any = false
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ**:
- `disallow_subclassing_any = false` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç –∫–ª–∞—Å—Å–æ–≤ –±–µ–∑ —Ç–∏–ø–æ–≤ (Model, BaseMiddleware)
- `disallow_untyped_decorators = false` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ –±–µ–∑ —Ç–∏–ø–æ–≤ (@router.message)
- `warn_unused_ignores = false` ‚Äî –Ω–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ "unused" type: ignore –≤ –º–æ–¥–µ–ª—è—Ö (–æ–Ω–∏ –Ω—É–∂–Ω—ã)

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ anthropic –≤ pre-commit

**–§–∞–π–ª**: `.pre-commit-config.yaml`

–î–æ–±–∞–≤–ª–µ–Ω anthropic –≤ `additional_dependencies` –¥–ª—è MyPy hook:

```yaml
- id: mypy
  additional_dependencies:
    - 'anthropic>=0.40.0'
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ**: Pre-commit –∑–∞–ø—É—Å–∫–∞–µ—Ç MyPy –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ aiosqlite –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–§–∞–π–ª**: `pyproject.toml`

–î–æ–±–∞–≤–ª–µ–Ω `aiosqlite` –≤ –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```toml
dependencies = [
    # ...
    "aiosqlite>=0.20.0",
]
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ**: Tortoise ORM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç aiosqlite –¥–ª—è SQLite –ë–î, –Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –µ–≥–æ –∫–∞–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å. –î–ª—è —Ç–µ—Å—Ç–æ–≤ (in-memory SQLite) –æ–Ω –Ω–µ–æ–±—Ö–æ–¥–∏–º.

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

```bash
# –õ–∏–Ω—Ç–∏–Ω–≥ –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—è
make check
# ‚úÖ Ruff: All checks passed!
# ‚úÖ MyPy: Success: no issues found in 18 source files

# –¢–µ—Å—Ç—ã
make test
# ‚úÖ 12 passed, 3 warnings

# Pre-commit hooks
uv run pre-commit run --all-files
# ‚úÖ –í—Å–µ hooks passed
```

### ‚úÖ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

```bash
make status
# ‚úÖ Python: 3.13.5
# ‚úÖ uv: 0.9.18
# ‚úÖ Docker: 29.1.3
# ‚úÖ Docker Compose: v2.40.3
# ‚úÖ Pre-commit: 4.5.1
# ‚úÖ .env: –°—É—â–µ—Å—Ç–≤—É–µ—Ç
```

---

## üéì –£—Ä–æ–∫–∏

### 1. MyPy strict mode + –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –±–µ–∑ —Ç–∏–ø–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: Strict mode MyPy –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏, –Ω–µ –∏–º–µ—é—â–∏–º–∏ —Ç–∏–ø–æ–≤ (Tortoise ORM, aiogram).

**–†–µ—à–µ–Ω–∏–µ**:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å per-file overrides –≤–º–µ—Å—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ
- –ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ (ORM, —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏)

### 2. Pre-commit –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞**: MyPy –≤ pre-commit –Ω–µ –≤–∏–¥–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ**: –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å `additional_dependencies` –≤ `.pre-commit-config.yaml`

### 3. –¢—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: aiosqlite –Ω–µ —É–∫–∞–∑–∞–Ω —è–≤–Ω–æ, —Ö–æ—Ç—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ Tortoise ORM.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª—è—Ç—å —è–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö features.

---

## üìù Checklist –¥–ª—è –±—É–¥—É—â–µ–≥–æ

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

- [ ] –ï—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –±–µ–∑ —Ç–∏–ø–æ–≤ ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –≤ `[[tool.mypy.overrides]]` —Å `ignore_missing_imports = true`
- [ ] –ï—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω—É–∂–Ω–∞ –¥–ª—è MyPy –≤ pre-commit ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –≤ `additional_dependencies`
- [ ] –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ORM/—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –±–µ–∑ —Ç–∏–ø–æ–≤ ‚Üí —Å–æ–∑–¥–∞—Ç—å per-file override —Å –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ–º strict checks
- [ ] –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞ ‚Üí –¥–æ–±–∞–≤–∏—Ç—å —è–≤–Ω–æ –≤ `dependencies`
- [ ] –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Üí –∑–∞–ø—É—Å—Ç–∏—Ç—å `make check && make test && uv run pre-commit run --all-files`

---

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
make check && make test

# Pre-commit
uv run pre-commit run --all-files

# –°—Ç–∞—Ç—É—Å –æ–∫—Ä—É–∂–µ–Ω–∏—è
make status

# –ü–æ–º–æ—â—å
make help
```

---

**–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç**: 21.12.2025
